インテグレーションテストの方針

外部APIなどの依存関係のみをモック化し、システム内のバックエンドとデータベースの相互作用を通してテストすることで、システム全体が部分的に統合された環境での動作を確認する。これにより、バックエンドとデータベースの接続や主要なデータフローが正しく機能しているかを検証します。

一つ以上のHappy pathをテストする。
この時Write系のAPIでは可能な限り最大値を使用してテストする。これは例えばデータベースで使用する型がvarchat(20)などのカラムがあるから。本来DBがvarchar(20)にすべきところを10にしてしまっていたなどに気づける。
Read系は複数のHappy pathをテストする事になりそう。特にページネーションやlimitだったり、Search系の場合は十分にテストするのが良いと思う。
DBに依存するエラーのテストを可能な限り行う。
バリデーションなどコードベースで発生するエラーに関しては単体テストの責務と考え、インテグレーションテストには不要。例えば同じemailがある場合にduplicateのエラーが発生する場合、その値はDBを見ているはずなのでこれは必要と判断する。
極めて発生頻度が低いエラーや、再現が困難なケースについては、無理にテストするよりも、テストのコストとメリットのバランスを考慮して除外するのが現実的です。特にULIDのような一意性を確保する仕組みがすでにあり、実際の運用で衝突する確率が非常に低い場合、そのエラーシナリオはテストから省略しても問題ないでしょう。